{% extends "base.html" %}
{% block content %}

<section class="card">
  <form method="post" id="route-form" class="form-grid" onsubmit="return handleSubmit()">
    <div class="field">
      <label>Point A</label>
      <input name="origin" id="origin" placeholder="e.g., Universiti Putra Malaysia"
             value="{{ origin_val|default('Universiti Putra Malaysia') }}" required />
    </div>

    <button type="button" class="btn ghost swap" id="swap-btn" title="Swap Aâ†”B" aria-label="Swap A and B">â†•</button>

    <div class="field">
      <label>Point B</label>
      <input name="dest" id="dest" placeholder="e.g., KLCC"
             value="{{ dest_val|default('KLCC') }}" required />
    </div>

    <div class="row">
      <button type="submit" id="submit-btn" class="btn primary">Find Shortest Route (A*)</button>
    </div>

    <div class="chips" aria-label="Quick examples">
      <span class="chip" data-a="Universiti Putra Malaysia" data-b="KLCC">UPM â†’ KLCC</span>
      <span class="chip" data-a="Mid Valley Megamall, Kuala Lumpur" data-b="Petronas Twin Towers, Kuala Lumpur">Mid Valley â†’ KLCC</span>
      <span class="chip" data-a="Sunway Pyramid, Subang Jaya" data-b="Bukit Bintang, Kuala Lumpur">Sunway â†’ Bukit Bintang</span>
      <span class="chip" data-a="Seri Kembangan, Selangor" data-b="KLCC, Kuala Lumpur">Seri Kembangan â†’ KLCC</span>
    </div>

    <p class="hint">
      Tip: è¾“å…¥æ›´å…·ä½“çš„åœ°åï¼ˆå«åŸå¸‚æˆ–å·ï¼Œå¦‚ <em>Seri Kembangan, Selangor</em>ï¼‰æ›´å®¹æ˜“è¢«å®šä½ã€‚
    </p>
  </form>
</section>

{% if distance_km %}
  <div class="result">
    <h2>Shortest Driving Distance: {{ "%.2f"|format(distance_km) }} km</h2>
  </div>
{% endif %}

<div class="map-container" id="map-container">
  {% if map_html %}
    {{ map_html|safe }}
  {% else %}
    <div class="map-placeholder">
      <p>ğŸ‘‹ è¾“å…¥èµ·ç‚¹ä¸ç»ˆç‚¹ï¼Œç„¶åç‚¹å‡»ä¸Šæ–¹æŒ‰é’®å¼€å§‹è®¡ç®—è·¯çº¿ã€‚</p>
    </div>
  {% endif %}
</div>

<div class="backdrop" id="backdrop" hidden>
  <div class="spinner" aria-label="Loading"></div>
  <p>Computing routeâ€¦</p>
</div>

{% endblock %}

{% block scripts %}
<script>
  // äº¤æ¢ A/B
  document.getElementById('swap-btn').addEventListener('click', () => {
    const a = document.getElementById('origin');
    const b = document.getElementById('dest');
    [a.value, b.value] = [b.value, a.value];
    a.focus();
  });

  // ç¤ºä¾‹ chip ç‚¹å‡»ä¸€é”®å¡«å……
  document.querySelectorAll('.chip').forEach(chip => {
    chip.addEventListener('click', () => {
      const a = document.getElementById('origin');
      const b = document.getElementById('dest');
      a.value = chip.dataset.a || a.value;
      b.value = chip.dataset.b || b.value;
      a.focus();
    });
  });

  // æäº¤æ—¶é˜²é‡å¤ + ç®€æ˜“åŠ è½½é®ç½©
  function handleSubmit() {
    const btn = document.getElementById('submit-btn');
    const bd = document.getElementById('backdrop');
    btn.disabled = true;
    btn.textContent = 'Workingâ€¦';
    bd.hidden = false;
    return true; // ç»§ç»­æäº¤
  }

  // å›è½¦ç›´æ¥æäº¤
  ['origin','dest'].forEach(id => {
    document.getElementById(id).addEventListener('keydown', e => {
      if (e.key === 'Enter') document.getElementById('route-form').requestSubmit();
    });
  });
</script>
{% endblock %}
